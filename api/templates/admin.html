<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Admin | Projo </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
    </style>
</head>
<header class="bg-gray-800 text-white">
    <a href="/">Homepage</a>
  </header>
<body class="bg-gray-800 text-white">
    <h1 class="text-5xl">CSV Microservices Admin</h1>
    <div class="flex gap-4 mt-4">
        <p onclick="loadTasks('/tasks?=pending')">Pending</p>
        <p onclick="loadTasks('/tasks?=processing')">Processing</p>
        <p onclick="loadTasks('/tasks?=completed')">Completed</p>
        <p onclick="loadTasks('/tasks?=failed')">Failed</p>
        <p onclick="loadTasks('/tasks')">All</p>
    </div>
   
        <ul id="tasksContainer">
            {% for task in tasks %}
            <li class="flex flex-col w-full  leading-1.5 p-4 bg-neutral-secondary-soft rounded-e-base rounded-es-base my-4">
                <div class="flex items-center justify-between
                            space-x-1.5 rtl:space-x-reverse w-full">
                    <a href="/tasks/{{task.id}}" class="text-md font-semibold text-heading mb-4">{{task.filename}}</a>
                    <span class="text-md text-body">{{task.status}}</span>
                </div>
                <p class="text-sm text-body">Uploaded at : {{task.created_at}}</p>
                <p class="text-sm text-body">Started Processing at : {{task.started_at}}</p>
                <p class="text-sm text-body"> Completed Processing at : {{task.completed_at}}</p>
            </li>
            {% endfor %}
        </ul>
    </div>

<script>
async function loadTasks(url) {
    try {
        const response = await fetch(url);
        const tasks = await response.json();

        const container = document.getElementById('tasksContainer');
        container.innerHTML = '';

        tasks.forEach(task => {
            const taskEl = document.createElement('li');
            taskEl.innerHTML = `
                <div class="flex flex-col w-full  leading-1.5 p-4 bg-neutral-secondary-soft rounded-e-base rounded-es-base my-4">
                        <div class="flex items-center justify-between
                                    space-x-1.5 rtl:space-x-reverse w-full">
                            <a href="/tasks/${task.id}" class="text-md font-semibold text-heading mb-4">${task.filename}</a>
                            <span class="text-md text-body">${task.status}</span>
                        </div>
                        <p class="text-sm text-body">Uploaded at : ${task.created_at}</p>
                        <p class="text-sm text-body">Started Processing at : ${task.started_at}</p>
                        <p class="text-sm text-body"> Completed Processing at : ${task.completed_at}</p>
                    </div>
            `;
            container.appendChild(taskEl);
        });
    } catch (error) {
        console.error('Failed to load tasks:', error);
    }
}



</script>

</body>
</html>